# 测试清单

## 启动前检查

- [ ] Redis 已启动并运行
  ```bash
  redis-cli ping
  # 应该返回: PONG
  ```

- [ ] CMPP 模拟器已启动（如果使用模拟器）
  ```bash
  # 使用内置模拟器
  cd vendor/github.com/bigwhite/gocmpp/examples/server
  go run server.go
  ```

- [ ] 配置文件 `config.json` 正确配置
  - Redis 地址和密码
  - CMPP 服务器地址
  - HTTP 服务端口

## 构建和启动

```bash
# 1. 构建项目
go build -mod=vendor

# 2. 启动服务
./cmpp-gateway

# 预期输出:
# ✅ 加载成功 => ...
# ✅ client connect and auth ok
# ✅ Loaded 6 template files
# ✅ HTTP server starting on 0.0.0.0:8000
# ✅ 连接Redis ... 成功
```

## 功能测试清单

### 1. 首页测试 (/)

访问：http://localhost:8000/

- [ ] **页面加载**
  - [ ] 无模板错误
  - [ ] 页面标题显示："首页 - CMPP Gateway"
  - [ ] 导航栏正确显示
  - [ ] 页脚正确显示

- [ ] **统计卡片显示**
  - [ ] 下发总数卡片（蓝色边框）
  - [ ] 成功数量卡片（绿色边框）
  - [ ] 失败数量卡片（红色边框）
  - [ ] 上行总数卡片（青色边框）
  - [ ] 数字显示正确（初次为 0 或实际数据）

- [ ] **发送表单**
  - [ ] 源号码单选框显示
  - [ ] 接收号码输入框
  - [ ] 短信内容文本框
  - [ ] 字符计数器工作（输入时更新）
  - [ ] 发送按钮可点击

- [ ] **连接状态卡片**
  - [ ] CMPP 服务器状态显示（绿色在线）
  - [ ] Redis 缓存状态显示（绿色在线）
  - [ ] 显示正确的 IP 和端口

- [ ] **快捷操作**
  - [ ] "查看下发记录" 链接可点击
  - [ ] "查看上行记录" 链接可点击

### 2. 发送短信功能测试

- [ ] **表单验证**
  - [ ] 空内容提交被阻止
  - [ ] 错误格式的手机号被阻止（如果有验证）

- [ ] **发送测试**
  - [ ] 填写测试号码（如：13800138000）
  - [ ] 填写测试内容（如："测试短信"）
  - [ ] 点击"发送短信"按钮
  - [ ] 显示"发送中..."加载状态
  - [ ] 成功后显示绿色提示："发送成功"
  - [ ] 表单自动清空
  - [ ] 字符计数器重置为 0
  - [ ] 下发总数 +1（刷新页面后可见）

### 3. 下发记录页面测试 (/list_message)

访问：http://localhost:8000/list_message

- [ ] **页面加载**
  - [ ] 无模板错误
  - [ ] 页面标题显示："下发记录 - CMPP Gateway"
  - [ ] 导航栏"下发记录"高亮显示

- [ ] **统计概览**
  - [ ] 总记录数卡片（蓝色）
  - [ ] 当前页卡片（绿色）
  - [ ] 总页数卡片（青色）
  - [ ] 数字显示正确

- [ ] **过滤器**
  - [ ] 接收号码输入框
  - [ ] 发送状态下拉框（全部/成功/失败）
  - [ ] 内容关键词输入框
  - [ ] 搜索按钮

- [ ] **消息列表表格**
  - [ ] 表头正确显示（序号、接收号码、短信内容、发送时间、消息ID、状态）
  - [ ] 如果有数据，显示消息列表
  - [ ] 如果无数据，显示友好提示（空状态）
  - [ ] 状态徽章颜色正确：
    - [ ] 成功 = 绿色徽章
    - [ ] 失败 = 红色徽章
    - [ ] 等待 = 黄色徽章

- [ ] **分页功能**
  - [ ] 如果有多页数据：
    - [ ] 显示分页按钮（最多5页）
    - [ ] 当前页高亮显示
    - [ ] "上一页"按钮在第一页时禁用
    - [ ] "下一页"按钮在最后一页时禁用
    - [ ] 点击页码可以跳转
    - [ ] 显示记录范围（如："显示第 1 - 5 条记录，共 10 条"）

- [ ] **自动刷新**
  - [ ] 等待 15 秒，页面自动刷新
  - [ ] 点击页面后，自动刷新停止

### 4. 上行记录页面测试 (/list_mo)

访问：http://localhost:8000/list_mo

- [ ] **页面加载**
  - [ ] 无模板错误
  - [ ] 页面标题显示："上行记录 - CMPP Gateway"
  - [ ] 导航栏"上行记录"高亮显示

- [ ] **统计概览**
  - [ ] 总记录数卡片（青色）
  - [ ] 当前页卡片（蓝色）
  - [ ] 总页数卡片（绿色）

- [ ] **过滤器**
  - [ ] 发送号码输入框
  - [ ] 接收号码输入框
  - [ ] 内容关键词输入框
  - [ ] 搜索按钮

- [ ] **消息列表表格**
  - [ ] 表头正确显示（序号、发送号码、接收号码、短信内容、接收时间、消息ID）
  - [ ] 数据显示正确或显示空状态

- [ ] **分页功能**
  - [ ] 分页按钮工作正常
  - [ ] 记录范围显示正确

- [ ] **自动刷新**
  - [ ] 等待 20 秒，页面自动刷新
  - [ ] 点击后停止自动刷新

### 5. 页面导航测试

- [ ] **从首页导航**
  - [ ] 点击"下发记录"菜单 → 正确跳转
  - [ ] 点击"上行记录"菜单 → 正确跳转
  - [ ] 点击"首页"菜单 → 返回首页
  - [ ] 点击 Logo "CMPP Gateway" → 返回首页

- [ ] **从下发记录页导航**
  - [ ] 点击"首页" → 正确跳转
  - [ ] 点击"上行记录" → 正确跳转

- [ ] **从上行记录页导航**
  - [ ] 点击"首页" → 正确跳转
  - [ ] 点击"下发记录" → 正确跳转

- [ ] **所有页面切换无错误**
  - [ ] 查看控制台日志，无 "Template execution error"
  - [ ] 查看浏览器控制台，无 JavaScript 错误

### 6. 响应式设计测试

- [ ] **桌面端 (> 992px)**
  - [ ] 统计卡片并排显示（4列）
  - [ ] 表格完整显示
  - [ ] 导航栏菜单展开显示

- [ ] **平板 (768px - 992px)**
  - [ ] 统计卡片适当调整（2列）
  - [ ] 表格可水平滚动
  - [ ] 导航栏显示正常

- [ ] **手机端 (< 768px)**
  - [ ] 统计卡片堆叠显示（1列）
  - [ ] 表格可水平滚动
  - [ ] 导航栏显示汉堡菜单
  - [ ] 点击汉堡菜单可展开/收起

### 7. 浏览器兼容性测试

- [ ] **Chrome/Edge (推荐)**
  - [ ] 所有功能正常
  - [ ] 样式显示正确
  - [ ] 动画流畅

- [ ] **Firefox**
  - [ ] 所有功能正常
  - [ ] 样式显示正确

- [ ] **Safari**
  - [ ] 所有功能正常
  - [ ] 样式显示正确

### 8. 性能测试

- [ ] **页面加载速度**
  - [ ] 首次加载 < 3 秒
  - [ ] 后续加载 < 1 秒（CDN 缓存）

- [ ] **模板加载**
  - [ ] 日志显示 "Loaded 6 template files"
  - [ ] 无重复加载提示

- [ ] **内存使用**
  - [ ] 长时间运行无内存泄漏
  - [ ] 自动刷新不导致内存持续增长

### 9. 错误处理测试

- [ ] **Redis 断开**
  - [ ] 停止 Redis
  - [ ] 访问页面，显示友好错误而非崩溃

- [ ] **CMPP 断开**
  - [ ] 停止 CMPP 服务器
  - [ ] 首页连接状态显示离线
  - [ ] 发送短信提示错误

- [ ] **无效请求**
  - [ ] 访问 /list_message?page=abc
  - [ ] 访问 /list_message?page=-1
  - [ ] 访问 /list_message?page=999999
  - [ ] 都应该正常处理或显示第一页

## 日志检查

### 正常日志示例

```
2025/10/29 13:19:55 加载成功 =>  &{...}
2025/10/29 13:19:55 client connect and auth ok
2025/10/29 13:19:55 Loaded 6 template files
2025/10/29 13:19:55 HTTP server starting on 0.0.0.0:8000
2025/10/29 13:19:55 连接Redis 127.0.0.1:6379 成功
```

### 不应出现的错误

- ❌ `Template execution error`
- ❌ `no such template`
- ❌ `can't evaluate field`
- ❌ `panic`
- ❌ `runtime error`

## 测试通过标准

- ✅ 所有页面无模板错误
- ✅ 所有功能按钮可用
- ✅ 数据显示正确
- ✅ 分页功能正常
- ✅ 导航切换流畅
- ✅ 响应式设计正常
- ✅ 无 JavaScript 错误
- ✅ 日志无错误信息

## 测试报告模板

```
测试日期：____________________
测试人员：____________________
测试环境：
  - OS: ____________________
  - Go 版本: _______________
  - 浏览器: ________________

测试结果：
[ ] 通过所有测试
[ ] 部分测试失败（见下方说明）

失败项目：
1. ___________________________
2. ___________________________

备注：
_________________________________
_________________________________
```

## 自动化测试脚本（可选）

```bash
#!/bin/bash

echo "开始自动化测试..."

# 1. 检查 Redis
redis-cli ping > /dev/null 2>&1
if [ $? -eq 0 ]; then
    echo "✅ Redis 连接正常"
else
    echo "❌ Redis 连接失败"
    exit 1
fi

# 2. 启动服务（后台）
./cmpp-gateway &
SERVER_PID=$!
sleep 2

# 3. 测试页面访问
echo "测试首页..."
curl -s http://localhost:8000/ | grep "控制面板" > /dev/null
if [ $? -eq 0 ]; then
    echo "✅ 首页加载成功"
else
    echo "❌ 首页加载失败"
fi

echo "测试下发记录页..."
curl -s http://localhost:8000/list_message | grep "下发短信记录" > /dev/null
if [ $? -eq 0 ]; then
    echo "✅ 下发记录页加载成功"
else
    echo "❌ 下发记录页加载失败"
fi

echo "测试上行记录页..."
curl -s http://localhost:8000/list_mo | grep "上行短信记录" > /dev/null
if [ $? -eq 0 ]; then
    echo "✅ 上行记录页加载成功"
else
    echo "❌ 上行记录页加载失败"
fi

# 4. 清理
kill $SERVER_PID

echo "测试完成！"
```

保存为 `test.sh`，使用 `chmod +x test.sh && ./test.sh` 运行。
